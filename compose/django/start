#!/bin/bash
set -o errexit
set -o pipefail
set -o nounset

# Skip migrations in replay mode - database calls are mocked
MODE_LOWER=$(echo "${TUSK_DRIFT_MODE:-}" | tr '[:upper:]' '[:lower:]')
if [ "$MODE_LOWER" != "replay" ]; then
    python manage.py migrate --noinput
fi

exec uvicorn app.asgi:application --host 0.0.0.0 --port 8000 --reload
